@* Displays sale page *@
@(id: Int)

@loggedinmain("Sale") {
<div class="container content">
    <div class="view profile" id="view-profile">
        <div class="row">
            <div class="col-sm-4">
                <a href="/sale/@id/addItem" class="btn btn-success">ADD ITEM</a>
            </div>
            <div class="col-sm-5"></div>
            <div class="col-sm-3">
                <div class="input-group">
                    <form class="form-search-field" action="/sale/@id/searchItems" method="post">
                        <div class="input-group">
                            <input type="text" class="form-control" name="query" placeholder="Search this sale...">
                        <span class="input-group-btn">
                            <button class="btn btn-default icon" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                        </span>
                        </div><!-- /input-group -->
                    </form>
                </div>
            </div>
        </div>

        <ul class="saleList">
            <h1 class="text-center" id="saleName"></h1>
            <div class="row">
                <div class="col-sm-3" id="saleAddress">
                    <h3 class="text-center">Address</h3>
                    <h4 id="saleAddress1"></h4>
                    <h4 id="saleAddress2"></h4>
                </div>
                <div class="col-sm-4">
                    <h3 class="text-center">Description</h3>
                    <h4 id="saleDescription"></h4>
                </div>
                <div class="col-sm-2">
                    <h3 class="text-center">Created By</h3>
                    <h4 id="saleCreatedBy" class="text-center"></h4>
                </div>
                <div class="col-sm-3">
                    <h3 class="text-center">Dates</h3>
                    <h4 id="saleDates"></h4>
                </div>
            </div>
            <h2 class="text-center">Items for Sale</h2>
            <div class="row">
                <div class="col-sm-2"></div>
                <div class="col-sm-8 items"></div>
            </div>
        </ul>
    </div>
</div>

<!-- script to add item info from database -->
<script>
    // Populate page with sale information
    $.post("/getSale", { "id" : "@id" }).done(function( data ) {
        var start = new Date(data.startDate),
        startTime = formatDate(start),
        end = new Date(data.endDate),
        endTime = formatDate(end);

        $("#saleName").text(data.name);
        $("#saleAddress1").text(data.street);
        $("#saleAddress2").text(data.city + ", " + data.state + " " + data.zip);
        $("#saleDescription").text(data.description);
        $("#saleCreatedBy").text(data.createdBy);
        $("#saleDates").text(startTime + " - " + data.endDate);
    });

    // Populate page with sale items
    $.post("/getItems", { "saleId" : "@id" }).done(function( data ) {
        for(var i in data) {
            var output = "<h2>" + data[i].name + "</h2>" + "<h3>" + data[i].description+ "</h3>" + "<h3>"
                + data[i].price + "</h3></div>";
            $(".items").append(output)
        }
    });

    function formatDate(date) {

        var year = date.getFullYear(),
        month = ('0' + (date.getMonth() + 1)).slice(-2),	// Months are zero based. Add leading 0.
        day= ('0' + date.getDate()).slice(-2),			// Add leading 0.
        hrs = date.getHours(),
        hours = hrs;
        mins = ('0' + date.getMinutes()).slice(-2),		// Add leading 0.
        ampm = 'AM';

        if (hrs > 12) {
            hours = hrs - 12;
            ampm = 'PM';
        } else if (hrs == 12) {
            hours = 12;
            ampm = 'PM';
        } else if (hrs == 0) {
            hours = 12;
        }

        return hours +':' + mins + ampm + ' ' + month + '/' + day + '/' + year;
    }


</script>

}
